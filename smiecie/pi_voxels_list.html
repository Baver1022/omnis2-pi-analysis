<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Lista Voxeli  - Analiza Kwadrat贸w</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: 'Courier New', monospace;
  background: #0a0a0a;
  color: #0ff;
  padding: 20px;
}
.header {
  background: linear-gradient(135deg, #001122, #003344);
  border: 2px solid #0ff;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 0 20px rgba(0,255,255,0.3);
}
h1 {
  color: #0ff;
  font-size: 24px;
  margin-bottom: 10px;
}
.stats {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
  margin-top: 15px;
}
.stat-box {
  background: rgba(0,255,255,0.1);
  border: 1px solid #0ff;
  border-radius: 5px;
  padding: 10px 15px;
  min-width: 150px;
}
.stat-label {
  color: #0aa;
  font-size: 12px;
  margin-bottom: 5px;
}
.stat-value {
  color: #0ff;
  font-size: 18px;
  font-weight: bold;
}
.controls {
  margin-bottom: 20px;
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  align-items: center;
}
input[type="text"], select {
  background: #001122;
  border: 1px solid #0ff;
  color: #0ff;
  padding: 8px 12px;
  border-radius: 4px;
  font-family: monospace;
  font-size: 14px;
}
input[type="text"]:focus, select:focus {
  outline: none;
  border-color: #0aa;
  box-shadow: 0 0 10px rgba(0,255,255,0.3);
}
button {
  background: #003344;
  border: 1px solid #0ff;
  color: #0ff;
  padding: 8px 16px;
  border-radius: 4px;
  cursor: pointer;
  font-family: monospace;
  transition: all 0.3s;
}
button:hover {
  background: #004455;
  box-shadow: 0 0 10px rgba(0,255,255,0.3);
}
button:active {
  background: #005566;
}
.voxel-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 10px;
  margin-bottom: 20px;
}
.voxel-item {
  background: rgba(0,255,255,0.05);
  border: 1px solid #0ff;
  border-radius: 5px;
  padding: 12px;
  cursor: pointer;
  transition: all 0.3s;
  position: relative;
}
.voxel-item:hover {
  background: rgba(0,255,255,0.15);
  border-color: #0aa;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,255,255,0.3);
}
.voxel-item.selected {
  background: rgba(0,255,255,0.2);
  border-color: #0aa;
  border-width: 2px;
}
.voxel-coords {
  font-size: 16px;
  font-weight: bold;
  color: #0ff;
  margin-bottom: 5px;
}
.voxel-count {
  font-size: 12px;
  color: #0aa;
}
.voxel-matrix-badge {
  display: inline-block;
  background: rgba(0,255,0,0.2);
  color: #0f0;
  font-size: 10px;
  padding: 2px 6px;
  border-radius: 3px;
  margin-top: 5px;
}
.details-panel {
  background: rgba(0,17,34,0.9);
  border: 2px solid #0ff;
  border-radius: 8px;
  padding: 20px;
  margin-top: 20px;
  display: none;
  max-height: 70vh;
  overflow-y: auto;
}
.details-panel.visible {
  display: block;
}
.details-header {
  font-size: 20px;
  color: #0ff;
  margin-bottom: 15px;
  border-bottom: 1px solid #0ff;
  padding-bottom: 10px;
}
.detail-section {
  margin-bottom: 20px;
}
.detail-label {
  color: #0aa;
  font-size: 14px;
  margin-bottom: 8px;
  font-weight: bold;
}
.detail-value {
  color: #0ff;
  font-size: 13px;
  background: rgba(0,255,255,0.05);
  padding: 10px;
  border-radius: 4px;
  border-left: 3px solid #0ff;
  word-break: break-all;
}
.matrix-display {
  font-family: monospace;
  font-size: 11px;
  line-height: 1.4;
  white-space: pre-wrap;
  max-height: 400px;
  overflow-y: auto;
  background: #000;
  padding: 10px;
  border-radius: 4px;
}
.triplets-list {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}
.triplet-item {
  background: rgba(0,255,255,0.1);
  border: 1px solid #0ff;
  padding: 4px 8px;
  border-radius: 3px;
  font-size: 12px;
}
.loading {
  text-align: center;
  padding: 40px;
  color: #0aa;
  font-size: 18px;
}
.error {
  background: rgba(255,0,0,0.2);
  border: 2px solid #f00;
  color: #f00;
  padding: 20px;
  border-radius: 8px;
  margin: 20px 0;
}
</style>
</head>
<body>
<div class="header">
  <h1> Analiza Voxeli  (Kwadrat贸w 3D)</h1>
  <div class="stats" id="stats">
    <div class="stat-box">
      <div class="stat-label">czna liczba voxeli</div>
      <div class="stat-value" id="total-voxels">-</div>
    </div>
    <div class="stat-box">
      <div class="stat-label">czna liczba punkt贸w</div>
      <div class="stat-value" id="total-points">-</div>
    </div>
    <div class="stat-box">
      <div class="stat-label">Voxele z macierzami</div>
      <div class="stat-value" id="voxels-with-matrix">-</div>
    </div>
  </div>
</div>

<div class="controls">
  <input type="text" id="search" placeholder="Szukaj (np. 1,1,1 lub liczba punkt贸w)">
  <select id="sort-by">
    <option value="coords">Sortuj: Wsp贸rzdne</option>
    <option value="count-desc">Sortuj: Najwicej punkt贸w</option>
    <option value="count-asc">Sortuj: Najmniej punkt贸w</option>
    <option value="matrix">Sortuj: Z macierz</option>
  </select>
  <button onclick="filterMatrix()">Tylko z macierz</button>
  <button onclick="resetFilter()">Reset</button>
</div>

<div class="loading" id="loading">Wczytywanie danych...</div>
<div class="voxel-list" id="voxel-list" style="display:none;"></div>
<div class="error" id="error" style="display:none;"></div>

<div class="details-panel" id="details-panel">
  <div class="details-header" id="details-header">Szczeg贸y Voxela</div>
  <div id="details-content"></div>
</div>

<script>
let voxelData = null;
let filteredVoxels = [];
let selectedVoxel = null;

// Wczytaj dane JSON
async function loadData() {
  try {
    const response = await fetch('pi_voxels_analysis.json');
    if (!response.ok) throw new Error('Nie mo偶na wczyta pliku');
    
    voxelData = await response.json();
    filteredVoxels = voxelData.voxels;
    
    // Aktualizuj statystyki
    document.getElementById('total-voxels').textContent = voxelData.total_voxels.toLocaleString();
    document.getElementById('total-points').textContent = voxelData.total_points.toLocaleString();
    
    const withMatrix = voxelData.voxels.filter(v => v.matrix !== null).length;
    document.getElementById('voxels-with-matrix').textContent = withMatrix.toLocaleString();
    
    // Ukryj loading, poka偶 list
    document.getElementById('loading').style.display = 'none';
    document.getElementById('voxel-list').style.display = 'grid';
    
    renderVoxels();
    
    // Event listeners
    document.getElementById('search').addEventListener('input', handleSearch);
    document.getElementById('sort-by').addEventListener('change', handleSort);
    
  } catch (error) {
    document.getElementById('loading').style.display = 'none';
    document.getElementById('error').style.display = 'block';
    document.getElementById('error').textContent = `Bd: ${error.message}`;
  }
}

function renderVoxels() {
  const container = document.getElementById('voxel-list');
  container.innerHTML = '';
  
  filteredVoxels.forEach((voxel, idx) => {
    const item = document.createElement('div');
    item.className = 'voxel-item';
    if (selectedVoxel === idx) item.classList.add('selected');
    
    const coords = voxel.coordinates;
    const coordsStr = `${coords.x},${coords.y},${coords.z}`;
    
    item.innerHTML = `
      <div class="voxel-coords">(${coordsStr})</div>
      <div class="voxel-count">${voxel.point_count.toLocaleString()} punkt贸w</div>
      ${voxel.matrix ? `<div class="voxel-matrix-badge">Macierz ${voxel.matrix.dimension}${voxel.matrix.dimension}${voxel.matrix.dimension}</div>` : ''}
    `;
    
    item.onclick = () => showDetails(idx);
    container.appendChild(item);
  });
}

function showDetails(idx) {
  selectedVoxel = idx;
  const voxel = filteredVoxels[idx];
  const panel = document.getElementById('details-panel');
  const content = document.getElementById('details-content');
  const header = document.getElementById('details-header');
  
  const coords = voxel.coordinates;
  header.textContent = `Voxel (${coords.x}, ${coords.y}, ${coords.z})`;
  
  let html = '';
  
  // Podstawowe informacje
  html += `<div class="detail-section">
    <div class="detail-label">Liczba punkt贸w:</div>
    <div class="detail-value">${voxel.point_count.toLocaleString()}</div>
  </div>`;
  
  // Macierz 3D
  if (voxel.matrix) {
    const dim = voxel.matrix.dimension;
    const matrixData = voxel.matrix.sample_layer || voxel.matrix.matrix;
    html += `<div class="detail-section">
      <div class="detail-label">Macierz 3D (${dim}${dim}${dim} = ${dim**3} punkt贸w):</div>
      <div class="detail-value">
        <div class="matrix-display">${formatMatrix3D(matrixData, dim)}</div>
        <div style="margin-top:10px; color:#0aa; font-size:11px;">
          Wymiary: ${voxel.matrix.shape ? voxel.matrix.shape.join('') : `${dim}${dim}${dim}`} | 
          cznie punkt贸w w voxelu: ${voxel.matrix.total_points || voxel.point_count}
        </div>
      </div>
    </div>`;
  } else {
    html += `<div class="detail-section">
      <div class="detail-label">Macierz 3D:</div>
      <div class="detail-value">${voxel.matrix_status || 'Brak macierzy'}</div>
    </div>`;
  }
  
  // Wartoci 3-cyfrowe
  const values = voxel.values_sample || voxel.values || [];
  const valuesCount = voxel.values_count || values.length;
  html += `<div class="detail-section">
    <div class="detail-label">Wartoci 3-cyfrowe (przykadowe, cznie ${valuesCount.toLocaleString()}):</div>
    <div class="detail-value">
      <div class="triplets-list">${values.slice(0, 100).map(v => `<span class="triplet-item">${v}</span>`).join('')}</div>
      ${valuesCount > 100 ? `<div style="margin-top:10px; color:#0aa;">... i ${(valuesCount - 100).toLocaleString()} wicej</div>` : ''}
    </div>
  </div>`;
  
  // Tr贸jki cyfr
  const triplets = voxel.triplets_sample || voxel.triplets || [];
  const tripletsCount = voxel.triplets_count || triplets.length;
  html += `<div class="detail-section">
    <div class="detail-label">Tr贸jki cyfr (przykadowe, cznie ${tripletsCount.toLocaleString()}):</div>
    <div class="detail-value">
      <div class="triplets-list">${triplets.slice(0, 50).map(t => `<span class="triplet-item">(${t[0]},${t[1]},${t[2]})</span>`).join('')}</div>
      ${tripletsCount > 50 ? `<div style="margin-top:10px; color:#0aa;">... i ${(tripletsCount - 50).toLocaleString()} wicej</div>` : ''}
    </div>
  </div>`;
  
  // Pozycje w cigu 
  const positions = voxel.positions_sample || voxel.positions || [];
  const positionsCount = voxel.positions_count || positions.length;
  html += `<div class="detail-section">
    <div class="detail-label">Pozycje w cigu  (przykadowe, cznie ${positionsCount.toLocaleString()}):</div>
    <div class="detail-value">${positions.slice(0, 20).join(', ')}${positionsCount > 20 ? ` ... (${positionsCount.toLocaleString()} cznie)` : ''}</div>
  </div>`;
  
  content.innerHTML = html;
  panel.classList.add('visible');
  renderVoxels(); // Odwie偶 list aby pokaza zaznaczenie
}

function formatMatrix3D(matrixData, dim) {
  let output = '';
  
  // Jeli mamy pen macierz
  if (Array.isArray(matrixData) && matrixData[0] && Array.isArray(matrixData[0][0])) {
    for (let z = 0; z < dim && z < matrixData.length; z++) {
      output += `\nWarstwa Z=${z}:\n`;
      for (let y = 0; y < dim && y < matrixData[z].length; y++) {
        let row = '';
        for (let x = 0; x < dim && x < matrixData[z][y].length; x++) {
          const [a, b, c] = matrixData[z][y][x];
          row += `(${a},${b},${c}) `;
        }
        output += row + '\n';
      }
    }
  } else if (Array.isArray(matrixData) && matrixData.length > 0) {
    // Przykadowa warstwa
    output += `\nPrzykadowa warstwa (Z=0, pierwsze wiersze):\n`;
    for (let y = 0; y < matrixData.length; y++) {
      let row = '';
      for (let x = 0; x < matrixData[y].length; x++) {
        const [a, b, c] = matrixData[y][x];
        row += `(${a},${b},${c}) `;
      }
      output += row + '\n';
    }
    output += `\n(Uwaga: To tylko przykadowa warstwa. Pena macierz ${dim}${dim}${dim} zawiera ${dim**3} punkt贸w)`;
  }
  
  return output;
}

function handleSearch(e) {
  const query = e.target.value.toLowerCase().trim();
  if (!query) {
    filteredVoxels = voxelData.voxels;
    handleSort();
    return;
  }
  
  filteredVoxels = voxelData.voxels.filter(v => {
    const coords = `${v.coordinates.x},${v.coordinates.y},${v.coordinates.z}`;
    return coords.includes(query) || 
           v.point_count.toString().includes(query) ||
           (v.matrix && v.matrix.dimension.toString().includes(query));
  });
  
  handleSort();
}

function handleSort() {
  const sortBy = document.getElementById('sort-by').value;
  
  switch(sortBy) {
    case 'coords':
      filteredVoxels.sort((a, b) => {
        const ac = a.coordinates;
        const bc = b.coordinates;
        if (ac.x !== bc.x) return ac.x - bc.x;
        if (ac.y !== bc.y) return ac.y - bc.y;
        return ac.z - bc.z;
      });
      break;
    case 'count-desc':
      filteredVoxels.sort((a, b) => b.point_count - a.point_count);
      break;
    case 'count-asc':
      filteredVoxels.sort((a, b) => a.point_count - b.point_count);
      break;
    case 'matrix':
      filteredVoxels.sort((a, b) => {
        if (a.matrix && !b.matrix) return -1;
        if (!a.matrix && b.matrix) return 1;
        if (a.matrix && b.matrix) {
          return b.matrix.dimension - a.matrix.dimension;
        }
        return 0;
      });
      break;
  }
  
  renderVoxels();
}

function filterMatrix() {
  filteredVoxels = voxelData.voxels.filter(v => v.matrix !== null);
  document.getElementById('sort-by').value = 'matrix';
  handleSort();
}

function resetFilter() {
  filteredVoxels = voxelData.voxels;
  document.getElementById('search').value = '';
  document.getElementById('sort-by').value = 'coords';
  handleSort();
}

// Start
loadData();
</script>
</body>
</html>


